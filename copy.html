<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
  <title>–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ‚Ä¶</title>
  <!-- –¢–µ–ª–µ–≥—Ä–∞–º WebApp JS -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root { color-scheme: light dark; }
    body {
      margin: 0; display: grid; place-items: center; height: 100dvh;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
      background: var(--tg-theme-bg-color,#111); color: var(--tg-theme-text-color,#fff);
    }
    .card {
      padding: 18px 16px; border-radius: 16px;
      background: rgba(255,255,255,.06); max-width: 720px; width: min(92vw,720px);
      text-align: center; backdrop-filter: blur(6px);
    }
    .t { opacity: .8; font-size: 14px; line-height: 1.35; word-break: break-word; }
    .btn {
      margin-top: 12px; padding: 14px 16px; width: 100%;
      border: 0; border-radius: 12px; font-weight: 600; font-size: 16px;
      background: var(--tg-theme-button-color,#2ea6ff); color: var(--tg-theme-button-text-color,#fff);
    }
    .hide { display: none; }
  </style>
</head>
<body>
  <div class="card">
    <div id="status" class="t">–ö–æ–ø–∏—Ä—É–µ–º‚Ä¶</div>
    <button id="copyBtn" class="btn hide">üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
  </div>

<script>
(function () {
  const tg = window.Telegram?.WebApp;
  const qs = new URLSearchParams(location.search);
  const text = qs.get("t") ? decodeURIComponent(qs.get("t")) : "";

  const $status = document.getElementById("status");
  const $btn = document.getElementById("copyBtn");

  function toast(msg) {
    try { tg?.showToast?.({ text: msg }); } catch (_) {}
  }
  function haptic() {
    try { tg?.HapticFeedback?.impactOccurred?.("light"); } catch (_) {}
  }
  function closeSoon(ms=150) {
    setTimeout(() => { try { tg?.close(); } catch (_) { window.close(); } }, ms);
  }

  async function copyNow() {
    if (!text) {
      $status.textContent = "–ù–µ—Ç —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è.";
      toast("–ù–µ—Ç —Ç–µ–∫—Å—Ç–∞");
      closeSoon(300);
      return;
    }
    try {
      // 1) –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π API
      if (navigator.clipboard?.writeText) {
        await navigator.clipboard.writeText(text);
      } else {
        // 2) –§–æ–ª–ª–±—ç–∫ —á–µ—Ä–µ–∑ textarea + execCommand
        const ta = document.createElement("textarea");
        ta.value = text;
        ta.style.position = "fixed";
        ta.style.opacity = "0";
        document.body.appendChild(ta);
        ta.focus();
        ta.select();
        document.execCommand("copy");
        ta.remove();
      }
      haptic();
      toast("–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ");
      $status.textContent = "–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ ‚úì";
      closeSoon();
    } catch (err) {
      // –ï—Å–ª–∏ –∞–≤—Ç–æ–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ (iOS –±–µ–∑ –∂–µ—Å—Ç–∞), –ø–æ–∫–∞–∂–µ–º –∫–Ω–æ–ø–∫—É
      console.warn("autocopy failed:", err);
      $status.textContent = "–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å";
      $btn.classList.remove("hide");
    }
  }

  // –ö–Ω–æ–ø–∫–∞ –Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ –±–µ–∑ ¬´–∂–µ—Å—Ç–∞¬ª –Ω–µ –¥–∞–ª–∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å
  $btn.addEventListener("click", async () => {
    try { await copyNow(); } catch (_) {}
  });

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp (—Ü–≤–µ—Ç–∞/–∫–Ω–æ–ø–∫–∏ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º)
  try { tg?.ready(); } catch (_) {}

  // –ü—ã—Ç–∞–µ–º—Å—è —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Ä–∞–∑—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
  copyNow();
})();
</script>
</body>
</html>
